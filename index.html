<!DOCTYPE html>
<html>
<head>
    <title>üî≠ Sky Scanner AI</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>üî≠ Sky Scanner AI</h1>
        <p>–¢–æ–ª—å–∫–æ —Ñ–æ—Ç–æ –Ω–µ–±–∞ —Å —Ç–µ–ª–µ—Å–∫–æ–ø–∞! (—á—ë—Ä–Ω—ã–π —Ñ–æ–Ω + –∑–≤—ë–∑–¥—ã)</p>
        <input type="file" id="imageInput" accept="image/*">
        <canvas id="canvas" width="400" height="400"></canvas>
        <div id="results"></div>
    </div>
    <script>
        document.getElementById('imageInput').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            const formData = new FormData();
            formData.append('image', file);
            
            const resp = await fetch('/analyze', {method: 'POST', body: formData});
            const data = await resp.json();
            
            // –†–∏—Å—É–µ–º —Ñ–æ—Ç–æ + –∫—Ä—É–≥–∏
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            img.onload = () => {
                ctx.drawImage(img, 0, 0, 400, 400);
                if (data.status.includes('‚úÖ')) {
                    data.objects.forEach(obj => {
                        ctx.beginPath();
                        ctx.arc(obj.x/2, obj.y/2, obj.r/2, 0, 2*Math.PI);
                        ctx.strokeStyle = '#00f0ff';
                        ctx.lineWidth = 3;
                        ctx.stroke();
                        ctx.fillStyle = 'rgba(0, 240, 255, 0.3)';
                        ctx.fill();
                    });
                }
            };
            img.src = 'image/jpeg;base64,' + data.image_b64;
            
            // –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
            document.getElementById('results').innerHTML = `
                <div class="result-box">
                    <h2>${data.status}</h2>
                    ${data.status.includes('‚úÖ') ? `
                        <p><strong>–û–±—ä–µ–∫—Ç–æ–≤:</strong> ${data.total}</p>
                        <p><strong>–ê–Ω–æ–º–∞–ª–∏—è:</strong> ${(data.anomaly_score*100).toFixed(1)}%</p>
                        <ul>${data.objects.map(o => 
                            `<li>${o.type} (x:${o.x}, y:${o.y}, r:${o.r}px)</li>`
                        ).join('')}</ul>
                    ` : '<p style="color:#ff4444">üì∏ –ó–∞–≥—Ä—É–∂–∞–π —Ñ–æ—Ç–æ –ß–Å–†–ù–û–ì–û –Ω–µ–±–∞ —Å —Ç–µ–ª–µ—Å–∫–æ–ø–∞!</p>'}
                </div>
            `;
        });
    </script>
</body>
</html>
